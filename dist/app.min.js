/*! Backoffice 2014-10-12 */
var app=angular.module("wt-backoffice",["wt-core","wt-ui","ngRoute","ngTouch","angularFileUpload"]);app.config(["$routeProvider",function(a){"use strict";a.when("/",{templateUrl:"components/login/login.html",controller:"loginController"}).when("/users",{templateUrl:"components/user/userList.html",controller:"userListController"}).when("/user",{templateUrl:"components/user/userDetails.html",controller:"userDetailsController"}).when("/user/:id",{templateUrl:"components/user/userDetails.html",controller:"userDetailsController"}).when("/files/upload",{templateUrl:"components/files/upload.html",controller:"uploadController"}).otherwise({redirectTo:"/"})}]),app.run(function(a){"use strict";a.defaults.headers.post["Content-Type"]="application/json"}),app.factory("processHandler",["toastr","translate",function(a,b){"use strict";return function(c,d){var e=function(){c[d]=!0},f=function(){a.show(b.getTerm("MSG_OPERATION_SUCCESS"),"success")},g=function(c){var d=[b.getTerm("MSG_OPERATION_FAIL")],e="error";c.data&&(c.data.messages&&(d=c.data.messages),c.data.type&&(e=c.data.type)),d.length>0&&a.show(d.join("<br />"),e)},h=function(){c[d]=!1};return{loading:c[d],onStart:e,onSuccess:f,onError:g,onFinally:h}}}]),app.controller("rootController",["$scope","$rootScope","$window","$location","eventHub","toastr","translate",function(a,b,c,d,e,f,g){"use strict";a.location=d,a.eventHub=e,a.toastr=f,a.goBack=function(){c.history.back()},a.goTo=function(a){d.path(a)},b.$on("APPLICATION_ERROR",function(a,b){f.show(b,"error")}),b.$on("UNAUTHORIZED",function(){a.toastr.show(g.getTerm("MSG_ACCESS_DENIED"),"error"),d.path("/login")})}]),app.controller("uploadController",["$scope","$upload",function(a,b){"use strict";a.upload=function(c){var d,e=0;for(e=0;e<c.length;e+=1)d=c[e],a.upload=b.upload({url:"/api/files/upload/",method:"POST",file:d}).progress(function(a){console.log("percent: "+parseInt(100*a.loaded/a.total))}).success(function(a){console.log(a)})}}]),app.controller("loginController",["$scope","$q","invoker","translate","authentication","processHandler",function(a,b,c,d,e,f){"use strict";var g=f(a,"loading");a.email="fabioseno@gmail.com",a.password="senha",a.loading=g.loading,a.authenticate=function(){function b(b){e.sessionId=b.headers("SessionId"),a.toastr.show(d.getTerm("MSG_ACCESS GRANTED",b.data.$$data.name),"success"),a.location.path("/users")}function f(){a.toastr.show(d.getTerm("MSG_OPERATION_FAIL"),"error")}var h=new jsSHA(a.password,"TEXT"),i=h.getHMAC(a.email,"TEXT","SHA-1","B64"),j={email:a.email,password:i};c.invoke("authentication","authenticate",j,g.onStart,b,f,g.onFinally)}}]),app.controller("menuController",["$scope","$location",function(a,b){"use strict";a.selectedItem={},a.menuItems=[{id:"home","class":"fa fa-home fa-lg fa-fw",name:"Home",link:"/users"},{id:"users","class":"fa fa-users fa-lg fa-fw",name:"Users",link:"",items:[{id:"userList",name:"User list",link:"/users"},{id:"newUser",name:"New user",link:"/user"}]}],a.selectItem=function(c){c.items&&c.items.length>0?(c.selected=!c.selected,c.selected&&(a.selectedItem=c)):c.link&&(a.selectedItem=c,b.path(c.link))}}]),app.directive("",function(){"use strict";return{}}),app.service("translate",function(){"use strict";var a={MSG_ACCESS_DENIED:"Acesso negado!","MSG_ACCESS GRANTED":"Acesso permitido!<br />Bem-vindo, {0}",MSG_CONFIRM_OPERATION:"Confirma a operação?",MSG_OPERATION_FAIL:"Ocorreu um erro durante a operação.<br />Por favor tente novamente!",MSG_OPERATION_SUCCESS:"Operação realizada com sucesso!",MSG_TYPE_SEARCH_TERM:"Digite um termo de busca...",LBL_CANCEL:"Cancelar",LBL_CREATE:"Criar",LBL_DELETE:"Excluir",LBL_EMAIL:"E-mail",LBL_ENTER:"Entrar",LBL_FILTER:"Filtrar",LBL_LOGIN:"Login",LBL_NAME:"Name",LBL_NEW_USER:"Novo usuário",LBL_PASSWORD:"Senha",LBL_PASSWORD_CONFIRMATION:"Confirmação de senha",LBL_STATUS:"Status",LBL_UPDATE:"Alterar",LBL_USER:"Usuário",LBL_USERS:"Usuários"};this.getTerm=function(b){var c,d=a[b]||"";if(arguments.length>1)for(c=1;c<arguments.length;c+=1)d=d.replace("{"+(c-1)+"}",arguments[c]);return d}}),app.filter("i18n",["translate",function(a){"use strict";return function(){return a.getTerm.apply(this,arguments)}}]),app.controller("userDetailsController",["$scope","$routeParams","$window","invoker","translate","processHandler",function(a,b,c,d,e,f){"use strict";function g(b){function c(){a.toastr.show(e.getTerm("MSG_OPERATION_SUCCESS"),"success"),a.location.path("/users")}d.invoke("user",b,a.user,h.onStart,c,h.onError,h.onFinally)}var h=f(a,"loading");a.user={},a.loading=h.loading,a.saveLabel=e.getTerm("LBL_CREATE"),a.isNew=!0,a.save=function(){var b="updateUser";a.isNew&&(b="createUser"),g(b)},a.remove=function(){c.confirm(e.getTerm("MSG_CONFIRM_OPERATION"))&&g("removeUser")},a.showUserDetails=function(b){function c(b){a.user=b.data.$$data}var f={id:b};b&&(a.isNew=!1,a.saveLabel=e.getTerm("LBL_UPDATE"),d.invoke("user","getDetails",f,h.onStart,c,h.onError,h.onFinally))},a.showUserDetails(b.id)}]),app.controller("userListController",["$scope","invoker","processHandler",function(a,b,c){"use strict";var d=c(a,"loading");a.users=[],a.currentPage=1,a.sortField={name:1},a.loading=d.loading,a.sort=function(b){a.sortField[b]?a.sortField[b]=1===a.sortField[b]?-1:1:(a.sortField={},a.sortField[b]=1),a.showUsers(a.currentPage)},a.showUsers=function(c){function e(b){a.users=b.data.$$data.list,a.totalPages=b.data.$$data.page.totalPages,a.currentPage=b.data.$$data.page.currentPage}var f={filter:{},page:{pageSize:2,currentPage:c}};a.sortField&&(f.sort=a.sortField),b.invoke("user","getList",f,d.onStart,e,d.onError,d.onFinally)},a.showUsers(1)}]);