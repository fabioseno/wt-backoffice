/*! Backoffice 2014-11-06 */
angular.module("wt-backoffice",["wt-core","wt-ui","ngRoute","ngTouch","angularFileUpload"]).config(["$routeProvider",function(a){"use strict";a.when("/",{templateUrl:"components/login/login.html",controller:"login",controllerAs:"vm"}).when("/users",{templateUrl:"components/user/userList.html",controller:"userList",controllerAs:"vm"}).when("/user",{templateUrl:"components/user/userDetails.html",controller:"userDetails",controllerAs:"vm"}).when("/user/:id",{templateUrl:"components/user/userDetails.html",controller:"userDetails",controllerAs:"vm"}).when("/user/resetPassword/:id",{templateUrl:"components/user/resetPassword.html",controller:"resetPassword",controllerAs:"vm"}).when("/profile",{templateUrl:"components/profile/myProfile.html",controller:"myProfile",controllerAs:"vm"}).when("/profile/changePassword",{templateUrl:"components/profile/changePassword.html",controller:"changePassword",controllerAs:"vm"}).when("/files/upload",{templateUrl:"components/files/upload.html",controller:"upload",controllerAs:"vm"}).otherwise({redirectTo:"/"})}]).run(function(a){"use strict";a.defaults.headers.post["Content-Type"]="application/json"}),function(){"use strict";function a(){this.getListMetadata=function(a,b,c){var d={filter:{},page:{pageSize:2,currentPage:a},searchTerm:c};return b&&(d.sort=b),d},this.sort=function(a,b,c,d){a.sortField[b]?a.sortField[b]=1===a.sortField[b]?-1:1:(a.sortField={},a.sortField[b]=1),c(d)}}a.$inject=["hub"],angular.module("wt-backoffice").service("form",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){this.$location=b,this.$q=c,this.$routeParams=d,this.$window=e,this.invoker=f,this.eventHub=g,this.translate=h,this.processHandler=i,this.toastr=j,a.$on("APPLICATION_ERROR",function(a,b){j.show(b,"error")}),a.$on("UNAUTHORIZED",function(){b.path("/login")}),a.$on("$routeChangeStart",function(){"/"===b.url()||"/login"===b.url()||k.getSessionId()||b.path("/login")})}a.$inject=["$rootScope","$location","$q","$routeParams","$window","invoker","eventHub","translate","processHandler","toastr","authentication"],angular.module("wt-backoffice").service("hub",a)}(),angular.module("wt-backoffice").factory("processHandler",["toastr","translate",function(a,b){"use strict";return function(c,d){d=d||"";var e=function(){c[d]=!0},f=function(){a.show(b.getTerm("MSG_OPERATION_SUCCESS"),"success")},g=function(c){var d=[],e="error";0===c.status?d.push(b.getTerm("MSG_UNABLE_TO_CONNECT_TO_SERVER")):c.data?(c.data.$$messages&&(d=c.data.$$messages),c.data.type&&(e=c.data.type)):d.push(b.getTerm("MSG_OPERATION_FAIL")),d.length>0&&a.show(d.join("<br />"),e)},h=function(){c[d]=!1};return{loading:c[d],onStart:e,onSuccess:f,onError:g,onFinally:h}}}]),function(){"use strict";function a(a){var b=this;b.goTo=function(b){a.path(b)}}a.$inject=["$location"],angular.module("wt-backoffice").controller("root",a)}(),angular.module("wt-backoffice").controller("upload",["$scope","$upload",function(a,b){"use strict";a.upload=function(c){var d,e=0;for(e=0;e<c.length;e+=1)d=c[e],a.upload=b.upload({url:"/api/files/upload/",method:"POST",file:d}).progress(function(a){console.log("percent: "+parseInt(100*a.loaded/a.total))}).success(function(a){console.log(a)})}}]),function(){"use strict";function a(){this.languages=[{key:"PT",name:"Português"},{key:"EN",name:"Inglês"}]}a.$inject=[],angular.module("wt-backoffice").service("languageModel",a)}(),function(){"use strict";function a(a,b){var c=this,d=a.processHandler(c);c.logout=function(){function c(){b.clearSession(),a.$location.path("/")}var e=b.getContext(),f={email:e.email};a.invoker.invoke("authentication","logout",f,d.onStart,c,d.onError,d.onFinally)}}a.$inject=["hub","authentication"],angular.module("wt-backoffice").controller("header",a)}(),function(){"use strict";function a(a){var b=this;b.selectedItem={},b.menuItems=[{id:"home","class":"fa fa-home fa-lg fa-fw",name:"Home",link:"/users"},{id:"users","class":"fa fa-users fa-lg fa-fw",name:"Users",link:"",items:[{id:"userList",name:"Usuários",link:"/users"},{id:"newUser",name:"Novo usuário",link:"/user"},{id:"myProfile",name:"Meu perfil",link:"/profile"}]}],b.selectItem=function(c){c.items&&c.items.length>0?(c.selected=!c.selected,c.selected&&(b.selectedItem=c)):c.link&&(b.selectedItem=c,a.path(c.link))}}a.$inject=["$location"],angular.module("wt-backoffice").controller("menu",a)}(),angular.module("wt-backoffice").directive("",function(){"use strict";return{}}),function(){"use strict";function a(a,b){var c=this,d=a.processHandler(c,"loading");c.email="fabioseno@gmail.com",c.password="senha",c.loading=d.loading,c.authenticate=function(){function e(c){b.setSessionId(c.headers("X-SessionId")),b.setContext(c.data.$$data),a.toastr.show(a.translate.getTerm("MSG_ACCESS GRANTED",c.data.$$data.name),"success"),a.$location.path("/users")}function f(){a.toastr.show(a.translate.getTerm("MSG_INVALID_USER_PASSWORD"),"error")}var g=new jsSHA(c.password,"TEXT"),h=g.getHMAC(c.email,"TEXT","SHA-1","B64"),i={email:c.email,password:h};a.invoker.invoke("authentication","authenticate",i,d.onStart,e,f,d.onFinally)}}a.$inject=["hub","authentication"],angular.module("wt-backoffice").controller("login",a)}(),function(){"use strict";function a(a,b){var c=this,d=a.processHandler(c,"loading");c.user={},c.loading=d.loading,c.save=function(){function b(){a.toastr.show(a.translate.getTerm("MSG_OPERATION_SUCCESS"),"success"),c.goBack()}var e,f=new jsSHA(c.user.password,"TEXT"),g=f.getHMAC(c.user.email,"TEXT","SHA-1","B64");e=angular.copy(c.user),e.password=g,f=new jsSHA(c.user.newPassword,"TEXT"),g=f.getHMAC(c.user.email,"TEXT","SHA-1","B64"),e.newPassword=g,a.invoker.invoke("user","changePassword",e,d.onStart,b,d.onError,d.onFinally)},c.showUserDetails=function(b){function e(a){a.data.$$data.password="",c.user=a.data.$$data}b&&a.invoker.invoke("user","getDetails",{id:b},d.onStart,e,d.onError,d.onFinally)},c.goBack=function(){a.$location.path("/profile")},c.showUserDetails(b.getContext().id)}a.$inject=["hub","authentication"],angular.module("wt-backoffice").controller("changePassword",a)}(),function(){"use strict";function a(a,b){var c=this,d=a.processHandler(c,"loading");c.user={},c.loading=d.loading,c.changePassword=function(){a.$location.path("/profile/changePassword")},c.showUserDetails=function(b){function e(a){a.data.$$data.password="",c.user=a.data.$$data}b&&a.invoker.invoke("user","getDetails",{id:b},d.onStart,e,d.onError,d.onFinally)},c.showUserDetails(b.getContext().id)}a.$inject=["hub","authentication"],angular.module("wt-backoffice").controller("myProfile",a)}(),angular.module("wt-backoffice").service("translate",function(){"use strict";var a={"MSG_ACCESS GRANTED":"Acesso permitido!<br />Bem-vindo, {0}",MSG_CONFIRM_OPERATION:"Confirma a operação?",MSG_OPERATION_FAIL:"Ocorreu um erro durante a operação.<br />Por favor tente novamente!",MSG_OPERATION_SUCCESS:"Operação realizada com sucesso!",MSG_SESSION_EXPIRED:"Sua sessão expirou.<br />Favor realizar novo login!",MSG_TYPE_SEARCH_TERM:"Digite um termo de busca...",MSG_UNABLE_TO_CONNECT_TO_SERVER:"Não foi possível conectar com o servidor!<br />Por favor tente novamente!",LBL_CANCEL:"Cancelar",LBL_CHANGE_PASSWORD:"Alterar senha",LBL_CREATE:"Criar",LBL_DELETE:"Excluir",LBL_EMAIL:"E-mail",LBL_ENTER:"Entrar",LBL_FILTER:"Filtrar",LBL_LANGUAGE:"Idioma",LBL_LANGUAGE_PT:"Português",LBL_LANGUAGE_EN:"Inglês",LBL_LOGIN:"Login",LBL_MY_PROFILE:"Meu perfil",LBL_NAME:"Name",LBL_NEW_USER:"Novo usuário",LBL_NEW_PASSWORD:"Nova senha",LBL_OLD_PASSWORD:"Senha atual",LBL_PASSWORD:"Senha",LBL_PASSWORD_CONFIRMATION:"Confirmação de senha",LBL_RESET_PASSWORD:"Redefinir senha",LBL_SELECT:"Selecione",LBL_STATUS:"Status",LBL_UPDATE:"Alterar",LBL_USER:"Usuário",LBL_USER_STATUS_A:"Ativo",LBL_USER_STATUS_I:"Inativo",LBL_USERS:"Usuários"},b=this;this.getTerm=function(b){var c,d=a[b]||"";if(arguments.length>1)for(c=1;c<arguments.length;c+=1)d=d.replace("{"+(c-1)+"}",arguments[c]);return d},this.getTermsList=function(a,c,d){return angular.forEach(a,function(a){a.$$term=b.getTerm(c+a[d])}),a}}),angular.module("wt-backoffice").filter("i18n",["translate",function(a){"use strict";return function(){return a.getTerm.apply(this,arguments)}}]),function(){"use strict";function a(a){var b=this,c=a.processHandler(b,"loading");b.user={},b.loading=c.loading,b.save=function(){function d(){a.toastr.show(a.translate.getTerm("MSG_OPERATION_SUCCESS"),"success"),b.goBack()}var e,f=new jsSHA(b.user.password,"TEXT"),g=f.getHMAC(b.user.email,"TEXT","SHA-1","B64");e=angular.copy(b.user),e.password=g,a.invoker.invoke("user","resetPassword",e,c.onStart,d,c.onError,c.onFinally)},b.showUserDetails=function(d){function e(a){a.data.$$data.password="",b.user=a.data.$$data}d&&a.invoker.invoke("user","getDetails",{id:d},c.onStart,e,c.onError,c.onFinally)},b.goBack=function(){a.$location.path("/user/"+a.$routeParams.id)},b.showUserDetails(a.$routeParams.id)}a.$inject=["hub"],angular.module("wt-backoffice").controller("resetPassword",a)}(),function(){"use strict";function a(a,b,c){function d(b){function c(){a.toastr.show(a.translate.getTerm("MSG_OPERATION_SUCCESS"),"success"),e.goBack()}var d,g=new jsSHA(e.user.password,"TEXT"),h=g.getHMAC(e.user.email,"TEXT","SHA-1","B64");d=angular.copy(e.user),"createUser"===b&&(d.password=h),a.invoker.invoke("user",b,d,f.onStart,c,f.onError,f.onFinally)}var e=this,f=a.processHandler(e,"loading");e.user={},e.languages=a.translate.getTermsList(c.languages,"LBL_LANGUAGE_","key"),e.statusList=a.translate.getTermsList(b.status,"LBL_USER_STATUS_","key"),e.loading=f.loading,e.saveLabel=a.translate.getTerm("LBL_CREATE"),e.isNew=!0,e.save=function(){d(e.isNew===!0?"createUser":"updateUser")},e.remove=function(){a.$window.confirm(a.translate.getTerm("MSG_CONFIRM_OPERATION"))&&d("removeUser")},e.resetPassword=function(){a.$location.path("/user/resetPassword/"+a.$routeParams.id)},e.showUserDetails=function(b){function c(a){e.user=a.data.$$data,e.user.password=" ",e.user.passwordConfirmation=" "}var d={id:b};b&&(e.isNew=!1,e.saveLabel=a.translate.getTerm("LBL_UPDATE"),a.invoker.invoke("user","getDetails",d,f.onStart,c,f.onError,f.onFinally))},e.goBack=function(){a.$location.path("/users")},e.showUserDetails(a.$routeParams.id)}a.$inject=["hub","userModel","languageModel"],angular.module("wt-backoffice").controller("userDetails",a)}(),function(){"use strict";function a(a,b){var c=this,d=a.processHandler(c,"loading");c.users=[],c.currentPage=1,c.sortField={name:1},c.loading=d.loading,c.sort=function(a){b.sort(c,a,c.showUsers,c.currentPage)},c.showUsers=function(e){function f(a){c.users=a.data.$$data.list,c.totalPages=a.data.$$data.page.totalPages,c.currentPage=a.data.$$data.page.currentPage}a.invoker.invoke("user","getList",b.getListMetadata(e,c.sortField,c.searchTerm),d.onStart,f,d.onError,d.onFinally)},c.showUsers(1)}a.$inject=["hub","form"],angular.module("wt-backoffice").controller("userList",a)}(),function(){"use strict";function a(){this.status=[{key:"A",name:"Active"},{key:"I",name:"Inactive"}]}a.$inject=[],angular.module("wt-backoffice").service("userModel",a)}();